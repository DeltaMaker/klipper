#
# Date: 10/6/2020
# DeltaMaker printer config file: printer-deltamaker-pro-tc-example.cfg
# Example ToolChanger configuration for DeltaMaker 2T
#
# Configure Halo Tool Dock with 4 swappable tools; T0, T1, T2, and T3
#
# Towers A,B,C
# Tool Bars: 1, 2, 3 
#              C
#            /   \
# (left) 2 /       \ 1 (right)
#        /           \
#      A - - - - - - - B
#          3 (front)
#  
# Status: 1 = tool dock location empty, 2 = tool dock occupied

# Initialize tool T0 on front tool bar, left position. 
[gcode_macro TC_T0]
variable_status: 1
variable_tool_bar: 3
variable_safe_x: -110.0
variable_safe_y: -150.0
variable_dock_x: -78.0
variable_dock_y: -191.0
variable_pick_x: -91.50
variable_pick_y: -222.5
variable_bar_z: 298.0
variable_below_z: 250.0
gcode:
   M118 TC_T0: status={status} bar={tool_bar} safe=({safe_x},{safe_y}) dock=({dock_x},{dock_y} pick=({pick_x},{pick_y}) z={bar_z}
   SET_TC_STATE
   {% if status == 1 %}
     G1 X0 Y0 Z{bar_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{dock_x} Y{dock_y}
   {% elif status == 2 %}
     G1 X0 Y0 Z{below_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{pick_x} Y{pick_y}
   {% endif %}
   RESTORE_STATE

# Initialize tool T1 on front tool bar, right position.
[gcode_macro TC_T1]
variable_status: 1
variable_tool_bar: 3
variable_safe_x: 93.0
variable_safe_y: -150.0
variable_dock_x: 105.0
variable_dock_y: -191.0
variable_pick_x: 91.0
variable_pick_y: -222.5
variable_bar_z: 298.0
variable_below_z: 250.0
gcode:
   M118 TC_T1: status={status} bar={tool_bar} safe=({safe_x},{safe_y}) dock=({dock_x},{dock_y} pick=({pick_x},{pick_y}) z={bar_z}
   SET_TC_STATE
   {% if status == 1 %}
     G1 X0 Y0 Z{bar_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{dock_x} Y{dock_y}
   {% elif status == 2 %}
     G1 X0 Y0 Z{below_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{pick_x} Y{pick_y}
   {% endif %}
   RESTORE_STATE

# Initialize tool T2 on right tool bar, front position
[gcode_macro TC_T2]
variable_status: 1
variable_tool_bar: 1
variable_safe_x: 150
variable_safe_y: 5
variable_dock_x: 191.8
variable_dock_y: 43.8
variable_pick_x: 225.6
variable_pick_y: 48.3
variable_bar_z: 298.0
variable_below_z: 250.0
gcode:
   M118 TC_T2: status={status} bar={tool_bar} safe=({safe_x},{safe_y}) dock=({dock_x},{dock_y} pick=({pick_x},{pick_y}) z={bar_z}
   SET_TC_STATE
   {% if status == 1 %}
     G1 X0 Y0 Z{bar_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{dock_x} Y{dock_y}
   {% elif status == 2 %}
     G1 X0 Y0 Z{below_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{pick_x} Y{pick_y}
   {% endif %}
   RESTORE_STATE

# Initialize tool T3 on right tool bar, rear position
[gcode_macro TC_T3]
variable_status: 1
variable_tool_bar: 1
variable_safe_x: 100.0
variable_safe_y: 140.0
variable_dock_x: 126.8
variable_dock_y: 156.4
variable_pick_x: 160.6
variable_pick_y: 160.8
variable_bar_z: 298.0
variable_below_z: 250.0
gcode:
   M118 TC_T3: status={status} bar={tool_bar} safe=({safe_x},{safe_y}) dock=({dock_x},{dock_y} pick=({pick_x},{pick_y}) z={bar_z}
   SET_TC_STATE
   {% if status == 1 %}
     G1 X0 Y0 Z{bar_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{dock_x} Y{dock_y}
   {% elif status == 2 %}
     G1 X0 Y0 Z{below_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{pick_x} Y{pick_y}
   {% endif %}
   RESTORE_STATE

# Initialize tool T4 on left tool bar, front position.
[gcode_macro TC_T4]
variable_status: 0
variable_tool_bar: 2
variable_safe_x: -150
variable_safe_y: 5
variable_safe_x: 100.0
variable_safe_y: 140.0
variable_dock_x: -98.7
variable_dock_y: 37.6
variable_pick_x: 0
variable_pick_y: 0
variable_bar_z: 298.0
variable_below_z: 250.0
gcode:
   M118 TC_T4: status={status} bar={tool_bar} safe=({safe_x},{safe_y}) dock=({dock_x},{dock_y} pick=({pick_x},{pick_y}) z={bar_z}
   SET_TC_STATE
   {% if status == 1 %}
     G1 X0 Y0 Z{bar_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{dock_x} Y{dock_y}
   {% elif status == 2 %}
     G1 X0 Y0 Z{below_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{pick_x} Y{pick_y}
   {% endif %}
   RESTORE_STATE

# Initialize tool T5 on left tool bar, rear position.
[gcode_macro TC_T5]
variable_status: 0
variable_tool_bar: 2
variable_safe_x: -100.0
variable_safe_y: 140.0
variable_dock_x: -98.7
variable_dock_y: 140.0
variable_pick_x: 0
variable_pick_y: 0
variable_bar_z: 298.0
variable_below_z: 250.0
gcode:
   M118 TC_T4: status={status} bar={tool_bar} safe=({safe_x},{safe_y}) dock=({dock_x},{dock_y} pick=({pick_x},{pick_y}) z={bar_z}
   SET_TC_STATE
   {% if status == 1 %}
     G1 X0 Y0 Z{bar_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{dock_x} Y{dock_y}
   {% elif status == 2 %}
     G1 X0 Y0 Z{below_z}
     G1 X{safe_x} Y{safe_y}
     G1 X{pick_x} Y{pick_y}
   {% endif %}
   RESTORE_STATE


#[gcode_macro INIT_TOOL_OFFSET]
#gcode:
#   G1 F10000
#   SET_GCODE_OFFSET X=0 Y=0 Z=0.35
#   SAVE_GCODE_STATE NAME=tool_offset_T0
#   SET_GCODE_OFFSET X=-0.2 Y=0 Z=0.25
#   SAVE_GCODE_STATE NAME=tool_offset_T1
#   SET_GCODE_OFFSET X=-0.175 Y=-0.77 Z=0.25
#   SAVE_GCODE_STATE NAME=tool_offset_T2

#######################

[gcode_macro BRUSH_T0]
gcode:
   #BRUSH_NOZZLE X=-50 Y=-90 Z=410 DX=-5 DY=-20 DZ=5

[gcode_macro BRUSH_T1]
gcode:
   #BRUSH_NOZZLE X=100 Y=0 Z=410 DX=15 DY=-5 DZ=5

[gcode_macro BRUSH_T2]
gcode:
   #BRUSH_NOZZLE X=-101 Y=0 Z=425 DX=-20

#######################

[delayed_gcode DANCE_LOOP]
initial_duration: 0
gcode:
      G1 X200 Y0
      G1 X-200
      G1 X0 Y-200
      G1 Y200
      G1 X-200 Y0 
      G1 X200
      G1 X0 Y-200
      G1 Y200
      UPDATE_DELAYED_GCODE ID=DANCE_LOOP DURATION=2

[gcode_macro START_DANCE]
gcode:
   G28
   G1 Z40 F25000
   SET_GCODE_OFFSET X=0 Y=0
   RESUME_DANCE

[gcode_macro RESUME_DANCE]
gcode:
   SET_VELOCITY_LIMIT VELOCITY=500 ACCEL=5000 ACCEL_TO_DECEL=3000
   UPDATE_DELAYED_GCODE ID=DANCE_LOOP DURATION=2

[gcode_macro PAUSE_DANCE]
gcode:
   SET_VELOCITY_LIMIT VELOCITY=200 ACCEL=2000 ACCEL_TO_DECEL=2000
   UPDATE_DELAYED_GCODE ID=DANCE_LOOP DURATION=0

[gcode_macro STOP_DANCE]
gcode:
   PAUSE_DANCE

